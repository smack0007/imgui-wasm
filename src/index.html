<!DOCTYPE html>
<html>
  <head></head>
  <body>
    <script type="module">
      const ERRNO_NOSYS = 52;

      const memory = new WebAssembly.Memory({ initial: 256 });
      const { instance } = await WebAssembly.instantiateStreaming(
        fetch("./imgui.wasm"),
        {
          env: { memory },
          wasi_snapshot_preview1: {
            args_get: function () {
              return ERRNO_NOSYS;
            },
            args_sizes_get: function () {
              return ERRNO_NOSYS;
            },
            clock_res_get: function () {
              return ERRNO_NOSYS;
            },
            clock_time_get: function () {
              return ERRNO_NOSYS;
            },
            environ_get: function () {
              return ERRNO_NOSYS;
            },
            environ_sizes_get: function () {
              return ERRNO_NOSYS;
            },
            fd_advise: function () {
              return ERRNO_NOSYS;
            },
            fd_allocate: function () {
              return ERRNO_NOSYS;
            },
            fd_close: function () {
              return ERRNO_NOSYS;
            },
            fd_datasync: function () {
              return ERRNO_NOSYS;
            },
            fd_fdstat_get: function () {
              return ERRNO_NOSYS;
            },
            fd_fdstat_set_flags: function () {
              return ERRNO_NOSYS;
            },
            fd_fdstat_set_rights: function () {
              return ERRNO_NOSYS;
            },
            fd_filestat_get: function () {
              return ERRNO_NOSYS;
            },
            fd_filestat_set_size: function () {
              return ERRNO_NOSYS;
            },
            fd_filestat_set_times: function () {
              return ERRNO_NOSYS;
            },
            fd_pread: function () {
              return ERRNO_NOSYS;
            },
            fd_prestat_dir_name: function () {
              return ERRNO_NOSYS;
            },
            fd_prestat_get: function () {
              return ERRNO_NOSYS;
            },
            fd_pwrite: function () {
              return ERRNO_NOSYS;
            },
            fd_read: function () {
              return ERRNO_NOSYS;
            },
            fd_readdir: function () {
              return ERRNO_NOSYS;
            },
            fd_renumber: function () {
              return ERRNO_NOSYS;
            },
            fd_seek: function () {
              return ERRNO_NOSYS;
            },
            fd_sync: function () {
              return ERRNO_NOSYS;
            },
            fd_tell: function () {
              return ERRNO_NOSYS;
            },
            fd_write: function () {
              return ERRNO_NOSYS;
            },
            path_create_directory: function () {
              return ERRNO_NOSYS;
            },
            path_filestat_get: function () {
              return ERRNO_NOSYS;
            },
            path_filestat_set_times: function () {
              return ERRNO_NOSYS;
            },
            path_link: function () {
              return ERRNO_NOSYS;
            },
            path_open: function () {
              return ERRNO_NOSYS;
            },
            path_readlink: function () {
              return ERRNO_NOSYS;
            },
            path_remove_directory: function () {
              return ERRNO_NOSYS;
            },
            path_rename: function () {
              return ERRNO_NOSYS;
            },
            path_symlink: function () {
              return ERRNO_NOSYS;
            },
            path_unlink_file: function () {
              return ERRNO_NOSYS;
            },
            poll_oneoff: function () {
              return ERRNO_NOSYS;
            },
            proc_exit: function () {
              return ERRNO_NOSYS;
            },
            proc_raise: function () {
              return ERRNO_NOSYS;
            },
            random_get: function () {
              return ERRNO_NOSYS;
            },
            sched_yield: function () {
              return ERRNO_NOSYS;
            },
            sock_accept: function () {
              return ERRNO_NOSYS;
            },
            sock_recv: function () {
              return ERRNO_NOSYS;
            },
            sock_send: function () {
              return ERRNO_NOSYS;
            },
            sock_shutdown: function () {
              return ERRNO_NOSYS;
            },
          },
        }
      );

      const __heap_base = instance.exports.__heap_base;

      function toCString(string) {
        for (let i = 0; i < string.length; i++) {
          memory[__heap_base + i] = string.charCodeAt(i);
        }

        memory[__heap_base + string.length] = 0;

        return __heap_base;
      }

      console.dir(instance.exports);
      console.info(instance.exports.__heap_base);

      console.info(instance.exports.igGET_FLT_MAX());

      const igContext = instance.exports.igCreateContext(null);
      console.info(igContext);
      instance.exports.igNewFrame();
      instance.exports.igShowDemoWindow(true);
      instance.exports.igRender();
      console.info(instance.exports.igGetDrawData());
    </script>
  </body>
</html>
